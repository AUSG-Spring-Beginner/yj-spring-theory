# μ»¨ν…μ΄λ„ μ΄κΈ°ν™”μ™€ μΆ…λ£
μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” μ΄κΈ°ν™”μ™€ μΆ…λ£λΌλ” λΌμ΄ν”„μ‚¬μ΄ν΄μ„ κ°–λ”λ‹¤. 
λ‹¤μ μ½”λ“μ™€ ν•¨κ» λ³΄μ.
```
// 1. μ»¨ν…μ΄λ„ μ΄κΈ°ν™”
AnnotationConfigApplicationContext ctx = 
	new AnnotationConfigApplicationContext(AppContext.class);
    
// 2. μ»¨ν…μ΄λ„μ—μ„ λΉ κ°μ²΄λ¥Ό κµ¬ν•΄μ„ μ‚¬μ©
Greeter g = ctx.getBean("greeter", Greeter.class);
String msg = g.greet("μ¤ν”„λ§");
System.out.println(msg);

// 3. μ»¨ν…μ΄λ„ μΆ…λ£
ctx.close();
```
μ„ μ½”λ“λ¥Ό λ³΄λ©΄, μ»¨ν…μ¤νΈ κ°μ²΄λ¥Ό μƒμ„±ν•λ” μ‹μ μ— μ¤ν”„λ§ μ»¨ν…μ΄λ„λ¥Ό μ΄κΈ°ν™”ν•λ” κ²ƒμ„ μ• μ μλ‹¤. μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” μ„¤μ • ν΄λμ¤μ—μ„ μ •λ³΄λ¥Ό μ½μ–΄μ™€ μ•λ§μ€ λΉ κ°μ²΄λ¥Ό μƒμ„±ν•κ³  κ° λΉμ„ μ—°κ²°(μμ΅΄ μ£Όμ…)ν•λ” μ‘μ—…μ„ μν–‰ν•λ‹¤.

> μ»¨ν…μ΄λ„λ¥Ό μ‚¬μ©ν•λ‹¤ = μ»¨ν…μ΄λ„μ— λ³΄κ΄€λ λΉ κ°μ²΄λ¥Ό κµ¬ν•λ‹¤

μ»¨ν…μ΄λ„ μ‚¬μ©μ΄ λλ‚λ©΄ μ»¨ν…μ΄λ„λ¥Ό μΆ…λ£ν•λ‹¤. μ΄ λ• μ‚¬μ©ν•λ” λ©”μ„λ“κ°€ ```close()```μ΄λ‹¤. 
> π’΅ close() λ©”μ„λ“λ” ```AbstractApplicationContext``` ν΄λμ¤μ— μ •μλμ–΄ μλ‹¤. μλ°” μ„¤μ •μ„ μ‚¬μ©ν•λ” ```AnnotationConfigApplicationContext``` ν΄λμ¤λ‚ XML μ„¤μ •μ„ μ‚¬μ©ν•λ” ```GenericXmlApplicationContext``` ν΄λμ¤ λ¨λ‘ ```AbstractApplicationContext``` ν΄λμ¤λ¥Ό μƒμ†λ°›κ³  μκΈ° λ•λ¬Έμ—, close() λ©”μ„λ“λ΅ μ»¨ν…μ΄λ„λ¥Ό μΆ…λ£ν•  μ μλ‹¤.

μ»¨ν…μ΄λ„λ¥Ό μ΄κΈ°ν™”ν•κ³  μΆ…λ£ν•  λ•μ—λ” λ‹¤μμ μ‘μ—…λ„ κ°™μ΄ μν–‰ν•λ‹¤.
- μ»¨ν…μ΄λ„ μ΄κΈ°ν™”
	- λΉ κ°μ²΄μ μƒμ„±
 	- μμ΅΄ μ£Όμ…
 	- μ΄κΈ°ν™”
- μ»¨ν…μ΄λ„ μΆ…λ£
	- λΉ κ°μ²΄μ μ†λ©Έ

# μ¤ν”„λ§ λΉ κ°μ²΄μ λΌμ΄ν”„μ‚¬μ΄ν΄
μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” λΉ κ°μ²΄μ λΌμ΄ν”„μ‚¬μ΄ν΄μ„ κ΄€λ¦¬ν•λ‹¤.
![](https://images.velog.io/images/nanaeu/post/c2cedb20-b205-456b-82e2-064fc2058efe/image.png)
- μ΄κΈ°ν™”
	- μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” κ°€μ¥ λ¨Όμ € λΉ κ°μ²΄ μƒμ„±ν•κ³  μμ΅΄ μ£Όμ…
	- μμ΅΄ μλ™ μ£Όμ…μ„ ν†µν• μμ΅΄ μ„¤μ •μ΄ μ΄ μ‹μ μ— μν–‰λ¨
	- λ¨λ“  μμ΅΄ μ„¤μ •μ΄ μ™„λ£λλ©΄ λΉ κ°μ²΄μ μ΄κΈ°ν™” μν–‰
	- λΉ κ°μ²΄λ¥Ό μ΄κΈ°ν™”ν•κΈ° μ„ν•΄ μ¤ν”„λ§μ€ λΉ κ°μ²΄μ μ§€μ •λ λ©”μ„λ“ νΈμ¶
- μ†λ©Έ
	- μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” μ§€μ •ν• λ©”μ„λ“λ¥Ό νΈμ¶ν•λ©° λΉ κ°μ²΄μ μ†λ©Έμ„ μ²λ¦¬
## π λΉ κ°μ²΄μ μ΄κΈ°ν™”μ™€ μ†λ©Έ: μ¤ν”„λ§ μΈν„°νμ΄μ¤
μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” λΉ κ°μ²΄λ¥Ό μ΄κΈ°ν™”ν•κ³  μ†λ©Έν•κΈ° μ„ν•΄ λΉ κ°μ²΄μ μ§€μ •ν• λ©”μ„λ“λ¥Ό νΈμ¶ν•λ”λ°, μ΄ λ©”μ„λ“λ” λ‹¤μμ λ‘ μΈν„°νμ΄μ¤μ— μ •μλμ–΄μλ‹¤.
- org.springframework.beans.factory.InitializingBean
- org.springframework.beans.factory.DisposableBean

λ‘ μΈν„°νμ΄μ¤λ” λ‹¤μκ³Ό κ°™λ‹¤.
```
public interface InitializingBean {
	void afterPropertiesSet() throws Exception;
}

public interface DisposableBean {
	void destroy() throws Exception;
}
```
### 1. InitializingBean
λΉ κ°μ²΄κ°€ ν•΄λ‹Ή μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•λ©΄ μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” μ΄κΈ°ν™” κ³Όμ •μ—μ„ λΉ κ°μ²΄μ ```afterPropertiesSet()``` λ©”μ„λ“λ¥Ό μ‹¤ν–‰ν•λ‹¤. 

λΉ κ°μ²΄λ¥Ό μƒμ„±ν• λ’¤ μ΄κΈ°ν™” κ³Όμ •μ΄ ν•„μ”ν•λ©΄ ν•΄λ‹Ή μΈν„°νμ΄μ¤λ¥Ό μƒμ†ν•κ³  ```afterPropertiesSet()``` λ©”μ„λ“λ¥Ό μ•λ§κ² κµ¬ν„ν•λ©΄ λλ‹¤.
### 2. DisposableBean
λΉ κ°μ²΄κ°€ ν•΄λ‹Ή μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν• κ²½μ° μ†λ©Έ κ³Όμ •μ—μ„ λΉ κ°μ²΄μ ```destroy()``` λ©”μ„λ“λ¥Ό μ‹¤ν–‰ν•λ‹¤.

λ§μ°¬κ°€μ§€λ΅ μ†λ©Έ κ³Όμ •μ΄ ν•„μ”ν• κ²½μ° ν•΄λ‹Ή μΈν„°νμ΄μ¤λ¥Ό μƒμ†ν•κ³  ```destroy()``` λ©”μ„λ“λ¥Ό μ•λ§κ² κµ¬ν„ν•λ©΄ λλ‹¤.

## π λΉ κ°μ²΄μ μ΄κΈ°ν™”μ™€ μ†λ©Έ: μ»¤μ¤ν…€ λ©”μ„λ“
λ¨λ“  ν΄λμ¤κ°€ InitializingBean μΈν„°νμ΄μ¤μ™€ DisposableBean μΈν„°νμ΄μ¤λ¥Ό μƒμ†λ°›μ•„ κµ¬ν„ν•  μ μλ” κ±΄ μ•„λ‹λ‹¤. λν• μ΄ λ‘ μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•μ§€ μ‹¶μ§€ μ•μ„ λ•λ„ μλ‹¤.

μ΄λ° κ²½μ°, μ¤ν”„λ§ μ„¤μ •μ—μ„ μ§μ ‘ λ©”μ„λ“λ¥Ό μ§€μ •ν•  μ μλ‹¤.

**@Bean νƒκ·Έμ—μ„ initMethod μ†μ„±κ³Ό destroyMethod μ†μ„±**μ„ μ‚¬μ©ν•μ—¬ μ΄κΈ°ν™” λ©”μ„λ“μ™€ μ†λ©Έ λ©”μ„λ“μ μ΄λ¦„μ„ μ§€μ •ν•λ©΄ λλ‹¤.

μμ μ™€ ν•¨κ» λ³΄μ.

```
public class Client {
    private String host;
    
    public void setHost(String host) {
    	this.host = host;
    }
    
    public void connect() {
    	System.out.println("Client.connect() μ‹¤ν–‰");
    }
    
    public void send() {
    	System.out.println("Client.send() to " + host);
    }
    
    public void close() {
    	System.out.println("Client.close() μ‹¤ν–‰");
    }
}
```
Client ν΄λμ¤λ¥Ό λΉμΌλ΅ μ‚¬μ©ν•λ ¤λ©΄ μ΄κΈ°ν™” κ³Όμ •μ—μ„ connect() λ©”μ„λ“λ¥Ό μ‹¤ν–‰ν•κ³  μ†λ©Έ κ³Όμ •μ—μ„ close() λ©”μ„λ“λ¥Ό μ‹¤ν–‰ν•΄μ•Ό ν•λ‹¤κ³  ν•μ. κ·ΈλΌ λ‹¤μκ³Ό κ°™μ΄ @Bean μ• λ…Έν…μ΄μ…μ initMethod μ†μ„±κ³Ό destroyMethod μ†μ„±μ— λ©”μ„λ“ μ΄λ¦„μ„ μ§€μ •ν•΄μ£Όλ©΄ λλ‹¤.
```
@Bean(initMethod = "connect", destroyMethod = "close")
public Client client() {
    Client client = new Client();
    client.setHost("host");
    return client;
}
```
> π’΅ initMethod μ†μ„±κ³Ό destroyMethod μ†μ„±μ— μ§€μ •ν• λ©”μ„λ“λ” **νλΌλ―Έν„°κ°€ μ—†μ–΄μ•Ό ν•λ‹¤.** νλΌλ―Έν„°κ°€ μ΅΄μ¬ν•  κ²½μ° μµμ…‰μ…μ΄ λ°μƒν•λ‹¤.

# λΉ κ°μ²΄μ μƒμ„±κ³Ό κ΄€λ¦¬ λ²”μ„
μ΄μ „μ κΈ€μ—μ„ μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” λΉ κ°μ²΄λ¥Ό ν•λ‚λ§ μƒμ„±ν•λ‹¤κ³  ν–μ—λ‹¤. μ΄λ ‡κ² ν• μ‹λ³„μμ— λ€ν•΄ ν• κ°μ κ°μ²΄λ§ μ΅΄μ¬ν•λ” λΉμ€ **μ‹±κΈ€ν†¤(singleton)** λ²”μ„(scope)λ¥Ό κ°–λ”λ‹¤. λ³„λ„ μ„¤μ •μ„ ν•μ§€ μ•μΌλ©΄ λΉμ€ μ‹±κΈ€ν†¤ λ²”μ„λ¥Ό κ°–λ”λ‹¤. 
```
Client cl01 = ctx.getBean("client", Client.class);
Client cl02 = ctx.getBean("client", Client.class);
// cl01 == cl02
```

μ—¬κΈ°μ„, ~~μ‚¬μ© λΉλ„κ°€ λ‚®κΈ΄ ν•μ§€λ§~~ **ν”„λ΅ν† νƒ€μ…** λ²”μ„μ λΉμ„ μ„¤μ •ν•  μλ„ μλ‹¤. μ¦‰, λΉμ λ²”μ„λ¥Ό ν”„λ΅ν† νƒ€μ…μΌλ΅ μ§€μ •ν•λ©΄ λΉ κ°μ²΄λ¥Ό κµ¬ν•  λ•λ§λ‹¤ λ§¤λ² μƒλ΅μ΄ κ°μ²΄λ¥Ό μƒμ„±ν•λ‹¤λ” λ§μ΄λ‹¤. 

```
// client λΉμ λ²”μ„κ°€ ν”„λ΅ν† νƒ€μ…μΌ κ²½μ°, λ§¤λ² μƒλ΅μ΄ κ°μ²΄ μƒμ„±
Client cl01 = ctx.getBean("client", Client.class);
Client cl02 = ctx.getBean("client", Client.class);
// cl01 != cl02
```

μ΄λ ‡κ² νΉμ • λΉμ„ ν”„λ΅ν† νƒ€μ…μΌλ΅ μ§€μ •ν•λ ¤λ©΄, λ‹¤μκ³Ό κ°™μ΄ @Scope μ• λ…Έν…μ΄μ…μ— "prototype"μ„ κ°’μΌλ΅ μ£Όμ–΄ @Bean μ• λ…Έν…μ΄μ…κ³Ό ν•¨κ» μ‚¬μ©ν•λ©΄ λλ‹¤.

```
@Configuration
public class AppCtxWithPrototype {
    
    @Bean
    @Scope("prototype")
    public Client client() {
   		Client client = new Client();
        client.setHost("host");
        return client;
    }
    ...
}
```
λ³„λ„λ΅ μ„¤μ •ν•΄μ£Όμ§€ μ•λ” ν• κΈ°λ³Έμ μΌλ΅ μ‹±κΈ€ν†¤ λ²”μ„λ¥Ό κ°–μ§€λ§, 
μ‹±κΈ€ν†¤ λ²”μ„λ¥Ό **λ…μ‹μ μΌλ΅ μ§€μ •**ν•κ³  μ‹¶λ‹¤λ©΄ "prototype" λ€μ‹ μ— "singleton"μ„ μ£Όλ©΄ λλ‹¤.

> ### π’΅ μ£Όμ
> ν”„λ΅ν† νƒ€μ… λ²”μ„λ¥Ό κ°–λ” λΉμ€ **μ™„μ „ν• λΌμ΄ν”„μ‚¬μ΄ν΄μ„ λ”°λ¥΄μ§€ μ•λ”λ‹¤.**
> μ΄κΈ°ν™” μ‘μ—…κΉμ§€λ” μν–‰ν•μ§€λ§, μ»¨ν…μ΄λ„λ¥Ό μΆ…λ£ν•λ‹¤κ³  ν•΄μ„ μƒμ„±ν• ν”„λ΅ν† νƒ€μ… λΉ κ°μ²΄μ μ†λ©Έ λ©”μ„λ“λ” μ‹¤ν–‰ν•μ§€ μ•λ”λ‹¤. λ”°λΌμ„ μ†λ©Έμ²λ¦¬λ” μ½”λ“μ—μ„ μ§μ ‘ ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.
